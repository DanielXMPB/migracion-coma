services:
  reverse_proxy:
    image: 'jc21/nginx-proxy-manager'
    restart: unless-stopped
    container_name: reverse_proxy
    ports:
      - '80:80'
      - '81:81'
      - '443:443'
    volumes:
      - ./data:/data
      - ./letsencrypt:/etc/letsencrypt
  #    - ./caddy/Caddyfile:/etc/caddy/Caddyfile
  #    - ./caddy/site:/srv
  #    - ./caddy/caddy_data:/data
  #    - ./caddy/caddy_config:/config
    networks:
      - coma_network
    depends_on:
      - coma_eim
      - coma_eip
  db_poseidon:
    image: mysql:latest
    container_name: db_poseidon
    ports:
      - "3307:3306"
    environment:
      MYSQL_ROOT_PASSWORD: 1234
    volumes:
      - db_poseidon:/var/lib/mysql
      - ./datos/poseidon:/docker-entrypoint-initdb.d
    networks:
      - coma_network
    command: --default-authentication-plugin=mysql_native_password
  db_ffm:
    image: mysql:latest
    container_name: db_ffm
    ports:
      - "3308:3306"
    environment:
      MYSQL_ROOT_PASSWORD: 1234
    volumes:
      - db_ffm:/var/lib/mysql
      - ./datos/ffm:/docker-entrypoint-initdb.d
    networks:
      - coma_network
    command: --default-authentication-plugin=mysql_native_password
  coma_eim:
    depends_on:
      - db_poseidon
      - db_ffm
    image: untetheredj/coma:latest
    container_name: coma_eim
    #ports:
    #  - "9000:8080"
    volumes:
      - ./webapps/eisi.war:/datadrive/tomcat/webapps/eisi.war
      - ./archivos/eim/css:/datadrive/tomcat/datos/css
      - ./archivos/eim/archivos:/datadrive/tomcat/datos/archivos
      - ./archivos/eim/images:/datadrive/tomcat/datos/images
      - ./startup.sh:/datadrive/tomcat/startup.sh
    networks:
      - coma_network
    environment:
      MYSQL_ROOT_PASSWORD: 1234
      DIAMANTE_DNS: "db_ffm"
      POSEIDON_DNS: "db_poseidon"
      DATABASE_NAME: "diamante_eim"
      NOMBRE_ESCUELA: "Escuela de Ingeniería Mecánica"
      NOMBRE_ABREVIADO: "EIM"
      PROGRAMA_PREGRADO: "24"
      CODIGO_ESCUELA: "6560"
      POSGRADO_1: "217"
      POSGRADO_2: "314"
      POSGRADO_3: "339"
      POSGRADO_4: "361"
      POSGRADO_5: "362"
      POSGRADO_6: "338"
      POSGRADO_7: "99999"
      POSGRADO_8: "99999"
    command: bash -c "chmod +x /datadrive/tomcat/startup.sh && /bin/bash /datadrive/tomcat/startup.sh"
  coma_eip:
    depends_on:
      - db_poseidon
      - db_ffm
    image: untetheredj/coma:latest
    container_name: coma_eip
    #ports:
    #  - "9001:8080"
    volumes:
      - ./webapps/eisi.war:/datadrive/tomcat/webapps/eisi.war
      - ./archivos/eip/css:/datadrive/tomcat/datos/css
      - ./archivos/eip/archivos:/datadrive/tomcat/datos/archivos
      - ./archivos/eip/images:/datadrive/tomcat/datos/images
      - ./startup.sh:/datadrive/tomcat/startup.sh
    networks:
      - coma_network
    environment:
      MYSQL_ROOT_PASSWORD: 1234
      DIAMANTE_DNS: "db_ffm"
      POSEIDON_DNS: "db_poseidon"
      DATABASE_NAME: "diamante_eip"
      NOMBRE_ESCUELA: "Escuela de Ingeniería de Petróleos"
      NOMBRE_ABREVIADO: "EISI"
      PROGRAMA_PREGRADO: "11"
      CODIGO_ESCUELA: "6570"
      POSGRADO_1: "302"
      POSGRADO_2: "224"
      POSGRADO_3: "99999"
      POSGRADO_4: "99999"
      POSGRADO_5: "99999"
      POSGRADO_6: "99999"
      POSGRADO_7: "99999"
      POSGRADO_8: "99999"
    command: bash -c "chmod +x /datadrive/tomcat/startup.sh && /bin/bash /datadrive/tomcat/startup.sh"
volumes:
  caddy_data:
    external: true
  caddy_config:
  db_poseidon:
    external: false
  db_ffm:
    external: false
networks:
  coma_network:
    driver: bridge
    name: coma_network

# Calumet RealTime Models

> Proyecto Privado: sólo visible para usuarios del Grupo Calumet.

Modelos de datos del framework de comunicación en tiempo real para el proyecto COMA del Grupo Calumet.

## Uso

Este repositorio es un paquete de [NPM](https://www.npmjs.com/) **privado** que es utilizado en el
repositorio [RealTime](https://github.com/calumet/realtime). Para instalar/actualizar este paquete
en RealTime, es necesario introducir los datos de cuenta de GitHub.

## Tablas MySQL

Las nuevas tablas a crear en la base de datos `diamante` en MySQL se encuentran en la carpeta `schemes`.

- [`TB_RealtimeSpaces`](./schemes/spaces.sql) - Espacios de comunicación.
- [`TP_RealtimeSpaceRooms`](./schemes/spaces-rooms.sql) - Salas de espacios.
- [`TR_RealtimeRoomUsers`](./schemes/rooms-users.sql) - Usuarios de salas.
- [`TR_RealtimeRoomMessages`](./schemes/rooms-messages.sql) - Mensajes de salas.

La descripción de los campos se encuentra en los schemes.

## Datos Iniciales

Para tener el sistema de comunicación funcional es necesario crear datos base iniciales.

Primero se necesitan **espacios**. Una lista sugeridad es:

```sql
DELETE FROM TB_RealtimeSpaces;
INSERT INTO TB_RealtimeSpaces
  (Id, Code, Name)
  VALUES
  ('S1', 'aulavirtual', 'Aula Virtual'),
  ('S2', 'school', 'Escuela');
```

Donde se tiene un espacio para salas de comunicación del módulo "Aula Virtual"
y un espacio de salas para toda la comunidad académica del proyecto COMA.

## Administración de Salas

El proyecto COMA debería estar a cargo de la administración de las salas (`TP_RealtimeSpaceRooms`)
y de sus usuarios (`TR_RealtimeRoomUsers`).

El proyecto RealTime sólo debería leer los datos de las salas y sus usuarios, y hacer
manipulación de los datos de mensajes de las salas (`TR_RealtimeRoomMessages`).

Para administrar las salas de comunicación, sólo es necesario manipular las tablas
de datos. No hay necesidad de COMA de comunicarse directamente con RealTime para estas labores.

## Desarrollo

> Consideraciones del desarrollo de éste módulo

Este repositorio es un proyecto de Node.js y un paquete de NPM.

### Setup

Es necesario instalar:

- MySQL v5+
- Node.js v6+
- NPM v3+

Datos de conexión a MySQL como administrador por defecto están como:

- Usuario: `root`
- Contraseñ: `admin`

Se debe crear una base de datos para hacer testeos para este y el proyecto RealTime
llamada:

- `diamante_test`

Se encuentran backups en la carpeta `backups` para inicializar la base de datos.

Para cambiar datos de configuración por defecto, editar los archivos:

- `test-mocks.sh` - En donde se ejecutan conexiones a la base de datos directamente.
- `test/settings.js` - En donde se configura la conexión para uso en los tests.

### API

| Comando | Descripción |
| :------------- | :------------- |
| `npm run mocks` | Actualiza la base de datos de pruebas con datos para hacer testeos |
| `npm run test` | Se ejecutan testeos básicos para probar el sistema de datos |

### Publicación

Al realizar cambios, actualizar la versión del paquete de NPM acorde a [semver.org](http://semver.org)
en el archivo `package.json`.
